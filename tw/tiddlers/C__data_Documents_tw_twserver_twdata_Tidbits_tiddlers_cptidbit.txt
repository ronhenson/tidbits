#! /usr/bin/bash

re='^tw'
sourcefile=$(basename $(ls /data/rh/Documents/tidbits-old/*.tdbi.html | head -1))
#sourcefile=$(basename) $sourcefile
if [[ $sourcefile =~ $re ]]; then echo "file name starts with tw, aborting"; exit ; fi
# sourcefile=$1
targetfile=${sourcefile:0:(-10)}.tid

cat /data/rh/Documents/tidbits/Atemplate.tid /data/rh/Documents/tidbits-old/$sourcefile > /data/rh/Documents/tidbits/$targetfile
mv /data/rh/Documents/tidbits-old/$sourcefile /data/rh/Documents/tidbits-old/tw_$sourcefile

echo $targetfile
newtitle=$(grep '"title"' $targetfile)
newtitle=${newtitle#*:}
newtitle=${newtitle//\"/}
newtitle=${newtitle// /_}
newtitle=${newtitle:0:(-1)}.tid

if [[ ${newtitle:0:1} == "_" ]]; then
    newtitle=${newtitle:1}
fi

newtitle=$(echo $newtitle | tr [A-Z] [a-z])

printf "%s\n" "$newtitle"
mv "$targetfile" "$newtitle"

printf "%s %s %s\n" "mv" "$targetfile" "$newtitle"

